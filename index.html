<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>crx file downloader</title>
        <link href="https://netdna.bootstrapcdn.com/bootswatch/2.1.0/cerulean/bootstrap.min.css" rel="stylesheet">
        <style>
            html, body, div.wrapper {
                margin: 0px;
                padding: 0px;
                width: 100%;
                height: 100%;
            }
            div.wrapper {
                display: table;
            }
            div.center {
                display: table-cell;
                vertical-align: middle;
            }
        </style>
    </head>
    <body>
        <div class="wrapper">
            <div class="container center">
                <div class="row-fluid">
                    <div class="span8 offset2 pagination-centered">
                        <h1>crx file downloader</h1>
                        <p class="lead">Download the Chrome extension (crx) file without installing it.</p>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span8 offset2 pagination-centered">
                        <form>
                            <label>Please paste the link to the extension's Chrome Web Store page here:</label>
                            <div class="input-append">
                                <input id="url" type="text" class="span8" placeholder="e.g. https://chrome.google.com/webstore/detail/google-mail-checker/mihcahmgecmbnbcchbopgniflfhgnkff">
                                <button id="download" type="submit" class="btn">Download</button>
                            </div>
                        </form>
                        or you can drag <a id="bookmark" href="http://zhuzhu.org">Download crx</a> to your bookmark toolbar, and use it on the extension's page directly.
                    </div>
                </div>
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script type="text/javascript">
            $('input#url').focus();

            var url_prefix = 'https://clients2.google.com/service/update2/crx?response=redirect&x=id%3D';
            var url_suffix = '%26uc';
            //var id_regex = /\/([a-p]{32})/;
            var id_regex = /([a-p]{32})/;
                   
            $('form').submit(function() {
                var url = $('input#url').val();
                var id_list = url.match(id_regex);
                if (!id_list) {
                    alert('Invalid URL! Please try again.');
                } else {
                    window.open(url_prefix + id_list[1] + url_suffix);
                }
                
                return false;
            });
            
            var bookmark_url = 'javascript:' + escape('window.open("' + url_prefix + '" + window.location.href.match(' + id_regex + ')[1] + "' + '" + "' + url_suffix + '")');
            // console.log(bookmark_url);
            $('a#bookmark').attr('href', bookmark_url);
        </script>
    </body>
</html>
